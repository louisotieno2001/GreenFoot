<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="styles/index.css">
    <link rel="icon" href="./res/logo.jpeg" type="image/x-icon">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Icons" />
    <link rel="stylesheet"
        href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0" />
    <title>Home</title>
    <style>
        body {
            display: flex;
            overflow-y: hidden;
            background-color: #424242;
            color: aliceblue;
            margin: 0;
        }

        .menu-icon-div {
            display: none;
        }

        #menu-icon {
            display: none;
        }

        #profile {
            overflow-y: auto;
            max-height: calc(100vh - 2px);
            /* Adjust the max-height as needed */
            width: 270px;
        }

        .card {
            background-color: #212121;
            margin: 20px;
            border-radius: 8px;
            width: 400px;
            padding: 2em;
        }

        .profile-photo {
            height: 100px;
            width: 100px;
            border-radius: 50%;
            background-image: url(../res/Create\ an\ image\ show\ \(1\).jpg);
            margin-left: 140px;
            background-position: center;
            background-size: cover;
        }

        .prof{
            width: 400px;
        }

        @media (max-width: 1068px) {
            #menu-icon {
                display: block;
            }

            .menu-icon-div {
                display: inline-block;
                position: fixed;
                cursor: pointer;
                top: 0;
                left: 0;
                width: 100%;
                z-index: 1000;
                background-color: #212121;
                flex-direction: row;
                /* Display horizontally */
                justify-content: flex-start;
                /* Align to the left */
                align-items: center;
                /* Center vertically */
                padding: 10px;
                /* Add padding for better appearance */
            }

            #mic-gif {
                display: none;
            }
        }
    </style>
</head>

<body>
    <div class="sidebar" id="sidebar" style="padding: 4em;">
        <a href="#" onclick="showTab('prompts')"><span class="material-icons">home</span> Home</a>
        <a href="#" onclick="showTab('profile')"><span class="material-icons">person</span> Profile</a>
        <a href="login.html"><span class="material-icons">logout</span> Logout</a>
    </div>
    <div class="menu-icon-div"><span class="material-symbols-outlined" class="menu-icon" id="menu-icon"
            title="Menu Icon">widgets</span></div>
    <div class="tabs-content">
        <div class="mic-gif" id="mic-gif"></div>
        <div id="prompts" class="tab-content active">
            <div class="response-area" id="response-area">
                <div class="logo"></div>
                <h1>How can I help you today?</h1>
            </div>
            <div class="sample-questions" id="sample-questions">
                <p id="carbon-definition">Define carbon footprint?</p>
                <p id="env-definition">Define environment</p>
            </div>
            <div class="result-area" id="result-area"></div>
            <div class="prompt-area" id="prompt-area">
                <span class="material-icons" id="mic" title="Speak to GreenFoot">mic</span>
                <input type="text" id="prompt-input" placeholder="How can I help you today?">
                <span class="material-icons" id="arrow" title="Send message to GreenFoot">arrow_circle_up</span>
            </div>
        </div>
        <div id="profile" class="tab-content">
            <!-- Add your profile content here -->
            <div class="prof">
                <h1>Profile</h1>
                <div class="profile-photo">
                </div>
                <div class="your-details">
                    <h1>Louis Ochieng</h1>
                    <h3>ELITE | 1.3K POINTS</h3>
                </div>
                <div class="achievements"></div>
            </div>

        </div>
    </div>
    <script>
        function showTab(tabId) {
            // Hide all tabs
            const tabs = document.querySelectorAll('.tab-content');
            tabs.forEach(tab => tab.classList.remove('active'));

            // Show the selected tab
            const selectedTab = document.getElementById(tabId);
            selectedTab.classList.add('active');
        }

        // Initially show the 'prompts' tab
        showTab('prompts');

        function showMic() {
            const micGifContainer = document.getElementById('mic-gif');
            const mic = document.getElementById('mic');
            const promptArea = document.getElementById('prompt-area');
            const sampleQuestions = document.getElementById('sample-questions');
            const responseArea = document.getElementById('response-area');
            const profile = document.getElementById('profile');
            const prompts = document.getElementById('prompts');

            // Create a new image element
            const micGif = new Image();
            micGif.src = '../res/mic.gif'; // Replace with your mic gif URL
            micGif.alt = 'Microphone Gif';
            micGif.classList.add('my-gif'); // Replace 'my-gif' with your desired class

            // Clear any previous content in micGifContainer
            micGifContainer.innerHTML = '';

            // Append the mic gif to the container
            micGifContainer.appendChild(micGif);

            // Set styles for micGifComntainer
            micGifContainer.style.backgroundColor = 'black';
            micGifContainer.style.width = '100%';
            micGifContainer.style.backgroundSize = 'cover';
            micGifContainer.style.backgroundPosition = 'center';

            // Center the mic gif on the page
            micGifContainer.style.display = 'flex';
            micGifContainer.style.justifyContent = 'center';
            micGifContainer.style.alignItems = 'center';
            micGifContainer.style.width = '100%';

            // Set body background color to black
            document.body.style.backgroundColor = 'black';

            // Remove space above micGifContainer
            micGifContainer.style.marginTop = '0px';

            // Hide other elements
            promptArea.style.display = 'none';
            sampleQuestions.style.display = 'none';
            responseArea.style.display = 'none';
            profile.style.display = 'none';
            prompts.style.display = 'none';
        }

        mic.addEventListener('click', async (e) => {
            e.preventDefault();
            showMic();
        });

        const cfDef = document.getElementById('carbon-definition');
        const envDef = document.getElementById('env-definition');
        const promptArea = document.getElementById('prompt-area');
        const sampleQuestions = document.getElementById('sample-questions');
        const result = document.getElementById('result-area');
        const responseArea = document.getElementById('response-area');

        function answers() {
            sampleQuestions.style.display = 'none';
            responseArea.style.display = 'none';
            result.style.fontFamily = 'sans-serif';
            result.style.fontSize = 'larger';
            result.style.fontWeight = 'bold';
        }

        cfDef.addEventListener("click", async (e) => {
            e.preventDefault();
            answers();
            // Create a new paragraph element
            const cfParagraph = document.createElement('p');
            // Set the text content for the paragraph
            cfParagraph.textContent = "Definition of Carbon Footprint: Carbon footprint is the total amount of greenhouse gases, specifically carbon dioxide, and other carbon compounds emitted directly or indirectly by human activities.";
            // Append the paragraph to the result area
            result.appendChild(cfParagraph);
            result.style.textAlign = 'center'
        });

        envDef.addEventListener("clickm", async (e) => {
            e.preventDefault();
            // Create a new paragraph element
            answers();
            const envParagraph = document.createElement('p');
            envParagraph.style.alignContent = 'center';
            // Set the text content for the paragraph
            envParagraph.textContent = "Definition of Environment: The environment refers to the surroundings in which organisms live, grow, and interact. It includes both living (biotic) and non-living (abiotic) components, such as air, water, soil, and ecosystems.";
            // Append the paragraph to the result area
            result.appendChild(envParagraph);
            result.style.textAlign = 'center'
        });

        // ChatGpt stuff

        const arrowIcon = document.getElementById('arrow');
        const promptInput = document.getElementById('prompt-input');
        const resultArea = document.getElementById('result-area');

        arrowIcon.addEventListener('click', async () => {
            const userQuery = promptInput.value.trim();

            // Check if the user entered a valid query
            if (userQuery) {
                // Reset result area
                resultArea.innerHTML = '';

                // Call a function to send the query to ChatGPT and handle the response
                await sendToChatGPT(userQuery);
            } else {
                // Handle case when the input is empty
                alert('Please enter a valid query.');
            }
        });



        function displayChatGPTResponse(response) {
            // Display the response in the result area
            const responseParagraph = document.createElement('p');
            responseParagraph.textContent = response;
            resultArea.appendChild(responseParagraph);
            resultArea.style.textAlign = 'center';
        }

        const menuIcon = document.getElementById('menu-icon');
        const sideBar = document.getElementById('sidebar');

        let isSideBarOpen = false;

        menuIcon.addEventListener('click', async (e) => {
            e.preventDefault();
            if (!isSideBarOpen) {
                sideBar.style.display = 'block';
                sideBar.style.zIndex = '1000';
                isSideBarOpen = true;
            } else {
                sideBar.style.display = 'none';
                isSideBarOpen = false;
            }
        });

        // Fetch user data from the database
        async function fetchUserData() {
            try {
                const response = await fetch('/renderData'); // Assuming this is the correct endpoint
                const userData = await response.json();
                console.log(userData);
                renderUserData(userData);
            } catch (error) {
                console.error('Error fetching user data:', error);
            }
        }

        function renderUserData(userData) {
            const profileContent = document.getElementById('profile'); // Get the profile tab content

            // Clear existing content
            // profileContent.innerHTML = '';

            userData.forEach(user => {
                // Create a card for personal information
                const personalInfoCard = document.createElement('div');
                personalInfoCard.classList.add('card');
                personalInfoCard.style.backgroundColor = '#212121'
                personalInfoCard.style.margin = '20px'
                personalInfoCard.style.borderRadius = '8px'
                personalInfoCard.style.width = '270px'
                personalInfoCard.style.padding = '2em'
                personalInfoCard.innerHTML = `
            <h2>Personal information</h2>
            <p>Username: ${user.username}</p>
            <p>Email: ${user.email}</p>
            <p>Phone: ${user.phone}</p>
            <p>Region: ${user.region}</p>
            <p>Township: ${user.township}</p>
        `;
                profileContent.appendChild(personalInfoCard);

                // Create a card for transport choices
                const transportCard = document.createElement('div');
                transportCard.classList.add('card');
                transportCard.style.backgroundColor = '#212121'
                transportCard.style.margin = '20px'
                transportCard.style.borderRadius = '8px'
                transportCard.style.width = '270px'
                transportCard.style.padding = '2em'
                const transportChoices = Object.keys(user.transport).filter(key => user.transport[key]);
                transportCard.innerHTML = `
            <h2>Transport Choices</h2>
            <p>${transportChoices.join(', ')}</p>
        `;
                profileContent.appendChild(transportCard);

                // Create a card for energy bills
                const energyCard = document.createElement('div');
                energyCard.style.backgroundColor = '#212121'
                energyCard.style.margin = '20px'
                energyCard.style.borderRadius = '8px'
                energyCard.style.width = '270px'
                energyCard.style.padding = '2em'
                energyCard.classList.add('card');
                energyCard.innerHTML = `
            <h2>Energy Bills</h2>
            <p>Water: ${user.energy.water}</p>
            <p>Cooling: ${user.energy.cooling}</p>
            <p>Heating: ${user.energy.heating}</p>
            <p>Electricity: ${user.energy.electricity}</p>
        `;
                profileContent.appendChild(energyCard);

                // Create a card for waste management
                const wasteManagementCard = document.createElement('div');
                wasteManagementCard.classList.add('card');
                wasteManagementCard.style.backgroundColor = '#212121'
                wasteManagementCard.style.margin = '20px'
                wasteManagementCard.style.borderRadius = '8px'
                wasteManagementCard.style.width = '270px'
                wasteManagementCard.style.padding = '2em'
                const wasteManagementChoices = Object.keys(user.waste_management).filter(key => user.waste_management[key]);
                wasteManagementCard.innerHTML = `
            <h2>Waste Management Choices</h2>
            <p>${wasteManagementChoices.join(', ')}</p>
        `;
                profileContent.appendChild(wasteManagementCard);

                // Create a card for energy sources
                const energySourcesCard = document.createElement('div');
                energySourcesCard.classList.add('card');
                energySourcesCard.style.backgroundColor = '#212121'
                energySourcesCard.style.margin = '20px'
                energySourcesCard.style.borderRadius = '8px'
                energySourcesCard.style.width = '270px'
                energySourcesCard.style.padding = '2em'
                const energySources = Object.keys(user.energy_sources).filter(key => user.energy_sources[key]);
                energySourcesCard.innerHTML = `
            <h2>Energy Sources</h2>
            <p>${energySources.join(', ')}</p>
        `;
                profileContent.appendChild(energySourcesCard);

                // Create a card for fashion choices
                const fashionCard = document.createElement('div');
                fashionCard.classList.add('card');
                fashionCard.style.backgroundColor = '#212121'
                fashionCard.style.margin = '20px'
                fashionCard.style.borderRadius = '8px'
                fashionCard.style.width = '270px'
                fashionCard.style.padding = '2em'
                const fashionChoices = Object.keys(user.fashion).filter(key => user.fashion[key]);
                fashionCard.innerHTML = `
            <h2>Fashion Choices</h2>
            <p>${fashionChoices.join(', ')}</p>
        `;
                profileContent.appendChild(fashionCard);

                // Create a card for diet choices
                const dietCard = document.createElement('div');
                dietCard.classList.add('card');
                dietCard.style.backgroundColor = '#212121'
                dietCard.style.margin = '20px'
                dietCard.style.borderRadius = '8px'
                dietCard.style.width = '270px'
                dietCard.style.padding = '2em'
                const dietChoices = Object.keys(user.diet).filter(key => user.diet[key]);
                dietCard.innerHTML = `
            <h2>Diet Choices</h2>
            <p>${dietChoices.join(', ')}</p>
        `;
                profileContent.appendChild(dietCard);
            });
        }



        // Call fetchUserData() when the profile tab is clicked
        // document.getElementById('profile').addEventListener('click', fetchUserData);

        // Initially fetch user data when the page loads
        window.onload = fetchUserData;




    </script>
</body>

</html>